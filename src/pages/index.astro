---
import IndexBase from '@src/layouts/IndexBase.astro';

import Hero from '@src/components/Hero';
import Health from '@src/components/Health';
import About from '@src/components/About';
import Blog from '@src/components/Blog';
import Projects from '@src/components/Projects';
import {
  getTopPostsGroupedByYear,
  getTopProjects,
  getAllPosts,
  getAllProjects,
} from '@src/domain/content';
import { fetchLocationData } from '@src/domain/location';
import {
  fetchRestingHeartRate,
  fetchHRV,
  fetchBodySurfaceTemp,
  fetchLastSleep,
} from '@src/domain/healthkit';
import { fetchWorkoutStats } from '@src/domain/workouts';

const topPostsByYear = getTopPostsGroupedByYear(5);
const topProjects = getTopProjects(3);
const totalPosts = getAllPosts().length;
const totalProjects = getAllProjects().length;
const locationData = await fetchLocationData();
const rhrData = await fetchRestingHeartRate();
const hrvData = await fetchHRV();
const bodyTempData = await fetchBodySurfaceTemp();
const workoutStats = await fetchWorkoutStats();
const lastSleepData = await fetchLastSleep();
---

<IndexBase>
  <Hero client:idle />
  <Health
    rhrData={rhrData}
    hrvData={hrvData}
    bodyTempData={bodyTempData}
    workoutStats={workoutStats}
    locationData={locationData}
    lastSleepData={lastSleepData}
  />
  <!-- <About /> -->
  <Blog
    postsByYear={topPostsByYear}
    totalPosts={totalPosts}
  />
  <Projects
    projects={topProjects}
    totalProjects={totalProjects}
  />
</IndexBase>
