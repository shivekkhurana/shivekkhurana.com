---
import Seo from '@src/components/Seo';
import HtmlLayout from '@src/layouts/Html.astro';
import BodyLayout from '@src/layouts/Body.astro';
import HeadLayout from '@src/layouts/Head.astro';
import { fetchLocationData } from '@src/domain/location';
import {
  fetchRestingHeartRate,
  fetchHRV,
  fetchBodySurfaceTemp,
} from '@src/domain/healthkit';
import { fetchWorkoutStats } from '@src/domain/workouts';

import clsx from 'clsx';
import Spotlight from '@src/components/Spotlight';
import Timeline from '@src/components/Timeline';
import About from '@src/components/About';
import Nav from '@src/components/Nav';

const locationData = await fetchLocationData();
const rhrData = await fetchRestingHeartRate();
const hrvData = await fetchHRV();
const bodyTempData = await fetchBodySurfaceTemp();
const workoutStats = await fetchWorkoutStats();
---

<HtmlLayout>
  <HeadLayout>
    <Seo
      title={'Shivek Khurana (formerly Krim Labs)'}
      subTitle={'Hi, my name is Shivek. Krim is my interface to the world.'}
      tags={'Krim Labs, krim, labs, shivek khurana, shivek, clojure, krimlabs, krimlabs.com'}
      authorName={'Shivek Khurana'}
      heroImg={'/img/og.png'}
    />
  </HeadLayout>

  <BodyLayout>
    <Nav
      rhrData={rhrData}
      hrvData={hrvData}
      bodyTempData={bodyTempData}
      workoutStats={workoutStats}
    />

    <div class={clsx('w-11/12 mx-auto lg:w-8/12 xl:w-6/12', '')}>
      <div class={clsx('flex flex-col md:flex-row', '')}>
        <main class={clsx('flex-grow', 'break-words', 'pr-4')}>
          <slot />
        </main>
        <aside class={clsx('w-full md:w-[320px] flex-shrink-0', 'md:pr-4')}>
          <Spotlight locationData={locationData} />
        </aside>
      </div>
    </div>
  </BodyLayout>
</HtmlLayout>
